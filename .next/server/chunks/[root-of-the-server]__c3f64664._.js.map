{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 186, "column": 0}, "map": {"version":3,"sources":["file:///Users/sepperuysschaert/Sites/Snaque2/src/app/api/order/email/route.ts"],"sourcesContent":["// app/api/order/route.ts\nimport { NextResponse } from \"next/server\";\nimport nodemailer from \"nodemailer\";\n\nconst {\n  SMTP_HOST,\n  SMTP_PORT = \"587\",\n  SMTP_SECURE = \"false\",\n  SMTP_USER,\n  SMTP_PASS,\n  ORDER_EMAIL_TO,\n  ORDER_EMAIL_FROM,\n} = process.env;\n\nconst PASTA_SLOTS = new Set([\"17:30\", \"18:30\"]);\nconst SIZE_SET = new Set([\"small\", \"medium\", \"large\"]);\nconst CHEESE_SET = new Set([\"met\", \"zonder\"]);\n\nexport async function POST(req: Request) {\n  try {\n    const { customer, items, total, placedAt } = await req.json();\n\n    // Basisvalidatie (bedrijf blijft optioneel)\n    if (\n      !customer?.name ||\n      !customer?.phone ||\n      !Array.isArray(items) ||\n      items.length === 0\n    ) {\n      return NextResponse.json({ error: \"Ongeldige payload\" }, { status: 400 });\n    }\n\n    // Validatie voor pasta-items\n    for (const it of items) {\n      const cat = String(it.category || \"\").toLowerCase();\n\n      if (cat === \"pasta\" || cat === \"pasta_special\") {\n        if (!it.timeslot || !PASTA_SLOTS.has(it.timeslot)) {\n          return NextResponse.json(\n            { error: \"Pasta vereist een geldig tijdslot\" },\n            { status: 400 }\n          );\n        }\n        if (!it.size || !SIZE_SET.has(String(it.size).toLowerCase())) {\n          return NextResponse.json(\n            { error: \"Pasta vereist een maat: small, medium of large\" },\n            { status: 400 }\n          );\n        }\n        // âœ… Kaas verplicht (met/zonder) voor pasta & pasta_special\n        const ch = String(it.cheese || \"\").toLowerCase();\n        if (!CHEESE_SET.has(ch)) {\n          return NextResponse.json(\n            { error: \"Pasta vereist een keuze voor kaas: met of zonder\" },\n            { status: 400 }\n          );\n        }\n      }\n\n      // Sauzen enkel voor gewone pasta (niet specials)\n      if (cat === \"pasta\") {\n        const sauces = Array.isArray(it.sauces) ? it.sauces.filter(Boolean) : [];\n        if (sauces.length < 1 || sauces.length > 2) {\n          return NextResponse.json(\n            { error: \"Kies 1 of 2 sauzen voor pasta\" },\n            { status: 400 }\n          );\n        }\n      }\n    }\n\n    // Tekstregels per item\n    const lines = items.map((it: any) => {\n      const qty = it.qty ?? 1;\n      const removed = it.removed?.length ? ` | Weglaten: ${it.removed.join(\", \")}` : \"\";\n      const note = it.note ? ` | Opmerking: ${it.note}` : \"\";\n      const cat = String(it.category || \"\").toLowerCase();\n      const isPasta = cat === \"pasta\"; // sauzen enkel voor gewone pasta\n\n      const slot = it.timeslot ? ` | Timeslot: ${it.timeslot}` : \"\";\n      const size = it.size\n        ? ` | Maat: ${String(it.size).toLowerCase().replace(/^./, (c: string) => c.toUpperCase())}`\n        : \"\";\n      const sauces =\n        isPasta && Array.isArray(it.sauces) && it.sauces.length\n          ? ` | Sauzen: ${it.sauces.join(\" + \")}`\n          : \"\";\n      const bread = it.bread\n        ? ` | Brood: ${String(it.bread).toLowerCase() === \"bruin\" ? \"Bruin\" : \"Wit\"}`\n        : \"\";\n      const cheese =\n        it.cheese && CHEESE_SET.has(String(it.cheese).toLowerCase())\n          ? ` | Kaas: ${String(it.cheese).toLowerCase() === \"met\" ? \"met\" : \"zonder\"}`\n          : \"\";\n\n      return `â€¢ ${it.name} Ã— ${qty} â€” â‚¬ ${(it.price * qty).toFixed(2)}${slot}${size}${sauces}${cheese}${bread}${removed}${note}`;\n    });\n\n    // ðŸ‘‡ Nieuw: bedrijfsinfo in plain text\n    const isCompany = !!customer.isCompany;\n    const companyLine = customer.companyName ? `Bedrijf: ${customer.companyName}\\n` : \"\";\n    const companyFlag = `Zakelijk: ${isCompany ? \"ja\" : \"nee\"}\\n`;\n\n    const text = `Nieuwe bestelling via Snaque\n\nKlant: ${customer.name}\nTel.: ${customer.phone}\n${companyFlag}${companyLine}${customer.note ? `Notitie: ${customer.note}\\n` : \"\"}Datum/tijd: ${\n      placedAt ?? new Date().toISOString()\n    }\n\nItems:\n${lines.join(\"\\n\")}\n\nTotaal: â‚¬ ${Number(total).toFixed(2)}\n`;\n\n    // ðŸ‘‡ Nieuw: bedrijfsinfo in HTML\n    const html = `\n      <div style=\"font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;\">\n        <h2>Nieuwe bestelling via Snaque</h2>\n        <p>\n          <strong>Klant:</strong> ${escapeHtml(customer.name)}<br/>\n          <strong>Tel.:</strong> ${escapeHtml(customer.phone)}<br/>\n          <strong>Zakelijk:</strong> ${isCompany ? \"ja\" : \"nee\"}<br/>\n          ${customer.companyName ? `<strong>Bedrijf:</strong> ${escapeHtml(customer.companyName)}<br/>` : \"\"}\n          ${customer.note ? `<strong>Notitie:</strong> ${escapeHtml(customer.note)}<br/>` : \"\"}\n          <strong>Datum/tijd:</strong> ${placedAt ?? new Date().toISOString()}\n        </p>\n        <h3>Items</h3>\n        <ul>\n          ${items\n            .map((it: any) => {\n              const qty = it.qty ?? 1;\n              const removed = it.removed?.length ? ` | Weglaten: ${it.removed.join(\", \")}` : \"\";\n              const note = it.note ? ` | Opmerking: ${escapeHtml(it.note)}` : \"\";\n              const cat = String(it.category || \"\").toLowerCase();\n              const isPasta = cat === \"pasta\"; // sauzen enkel voor gewone pasta\n\n              const slot = it.timeslot ? ` | Timeslot: ${it.timeslot}` : \"\";\n              const size = it.size\n                ? ` | Maat: ${String(it.size).toLowerCase().replace(/^./, (c) => c.toUpperCase())}`\n                : \"\";\n              const sauces =\n                isPasta && Array.isArray(it.sauces) && it.sauces.length\n                  ? ` | Sauzen: ${it.sauces.join(\" + \")}`\n                  : \"\";\n              const bread = it.bread\n                ? ` | Brood: ${String(it.bread).toLowerCase() === \"bruin\" ? \"Bruin\" : \"Wit\"}`\n                : \"\";\n              const cheese =\n                it.cheese && CHEESE_SET.has(String(it.cheese).toLowerCase())\n                  ? ` | Kaas: ${String(it.cheese).toLowerCase() === \"met\" ? \"met\" : \"zonder\"}`\n                  : \"\";\n\n              const safeName = escapeHtml(it.name);\n              const safeRemoved = escapeHtml(removed);\n              const safeSlot = escapeHtml(slot);\n              const safeSize = escapeHtml(size);\n              const safeSauces = escapeHtml(sauces);\n              const safeCheese = escapeHtml(cheese);\n              const safeBread = escapeHtml(bread);\n\n              return `<li>${safeName} Ã— ${qty} â€” â‚¬ ${(it.price * qty).toFixed(2)}${safeSlot}${safeSize}${safeSauces}${safeCheese}${safeBread}${safeRemoved}${note}</li>`;\n            })\n            .join(\"\")}\n        </ul>\n        <p><strong>Totaal:</strong> â‚¬ ${Number(total).toFixed(2)}</p>\n      </div>\n    `;\n\n    // E-mail transport\n    const transporter = nodemailer.createTransport({\n      host: SMTP_HOST,\n      port: Number(SMTP_PORT),\n      secure: SMTP_SECURE === \"true\",\n      auth: SMTP_USER && SMTP_PASS ? { user: SMTP_USER, pass: SMTP_PASS } : undefined,\n    });\n\n    await transporter.sendMail({\n      from: ORDER_EMAIL_FROM || SMTP_USER,\n      to: ORDER_EMAIL_TO,\n      // ðŸ‘‡ Nieuw: toon bedrijfsnaam in subject indien beschikbaar\n      subject: `Nieuwe bestelling â€” ${customer.name}${\n        customer.companyName ? ` (${customer.companyName})` : \"\"\n      }`,\n      text,\n      html,\n    });\n\n    return NextResponse.json({ ok: true });\n  } catch (e: any) {\n    console.error(\"Order email error\", e);\n    return NextResponse.json({ error: \"Serverfout bij verzenden\" }, { status: 500 });\n  }\n}\n\n// kleine helper\nfunction escapeHtml(s: string) {\n  return String(s).replace(\n    /[&<>\\\"']/g,\n    (m) =>\n      ({ \"&\": \"&amp;\", \"<\": \"&lt;\", \">\": \"&gt;\", '\"': \"&quot;\", \"'\": \"&#039;\" }[m]!)\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}